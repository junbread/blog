<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>ì´í™í‹°ë¸Œ ìë°” 11ì¥ ì •ë¦¬ | JunbreadğŸ¥</title><meta name=keywords content="Study,Java"><meta name=description content="ì•„ì´í…œ 78: ê³µìœ  ì¤‘ì¸ ê°€ë³€ ë°ì´í„°ëŠ” ë™ê¸°í™”í•´ ì‚¬ìš©í•˜ë¼ ì—¬ëŸ¬ ìŠ¤ë ˆë“œê°€ í•˜ë‚˜ì˜ ê°€ë³€ ë°ì´í„°ë¥¼ ì‚¬ìš©í•  ë•Œì— ì…ì¶œë ¥ ì‹œ ë™ê¸°í™”ì— ì‹ ê²½ì“°ì§€ ì•ŠëŠ”ë‹¤ë©´ ì˜ëª»ëœ ë™ì‘ì„ ìœ ë°œí•  ìˆ˜ ìˆë‹¤.
// ì½”ë“œ 78-1 ì˜ëª»ëœ ì½”ë“œ - ì´ í”„ë¡œê·¸ë¨ì€ ì–¼ë§ˆë‚˜ ì˜¤ë˜ ì‹¤í–‰ë ê¹Œ? (415ìª½) public class StopThread { private static boolean stopRequested; public static void main(String[] args) throws InterruptedException { Thread backgroundThread = new Thread(() -> { int i = 0; while (!stopRequested) i++; }); backgroundThread.start(); TimeUnit.SECONDS.sleep(1); stopRequested = true; } } ì—¬ëŸ¬ ìŠ¤ë ˆë“œê°€ ê³µìœ í•˜ëŠ” ê°€ë³€ ë°ì´í„°ë¥¼ ë™ê¸°í™”í•˜ì§€ ì•Šì„ ê²½ìš° ë‹¤ë¥¸ ìŠ¤ë ˆë“œì—ì„œ ë³€ê²½í•œ ê°’ì„ ì–¸ì œ ë³´ê²Œ ë  ì§€ ì•Œ ìˆ˜ ì—†ë‹¤."><meta name=author content><link rel=canonical href=https://junbread.win/posts/2021/effective-java-11/><link crossorigin=anonymous href=/assets/css/stylesheet.f6c1b3e9443ffcf8efd37433e13b909fd545f99414f2ac3e5b22795096fc9f44.css integrity="sha256-9sGz6UQ//Pjv03Qz4TuQn9VF+ZQU8qw+WyJ5UJb8n0Q=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://junbread.win/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://junbread.win/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://junbread.win/favicon-32x32.png><link rel=apple-touch-icon href=https://junbread.win/apple-touch-icon.png><link rel=mask-icon href=https://junbread.win/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><link rel=stylesheet type=text/css crossorigin href=//cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.6/dist/web/variable/pretendardvariable-dynamic-subset.css><link rel=stylesheet type=text/css crossorigin href="//fonts.googleapis.com/css2?family=Source+Code+Pro"><script async src="https://www.googletagmanager.com/gtag/js?id=G-0QLLXH086F"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-0QLLXH086F",{anonymize_ip:!1})}</script><meta property="og:title" content="ì´í™í‹°ë¸Œ ìë°” 11ì¥ ì •ë¦¬"><meta property="og:description" content="ì•„ì´í…œ 78: ê³µìœ  ì¤‘ì¸ ê°€ë³€ ë°ì´í„°ëŠ” ë™ê¸°í™”í•´ ì‚¬ìš©í•˜ë¼ ì—¬ëŸ¬ ìŠ¤ë ˆë“œê°€ í•˜ë‚˜ì˜ ê°€ë³€ ë°ì´í„°ë¥¼ ì‚¬ìš©í•  ë•Œì— ì…ì¶œë ¥ ì‹œ ë™ê¸°í™”ì— ì‹ ê²½ì“°ì§€ ì•ŠëŠ”ë‹¤ë©´ ì˜ëª»ëœ ë™ì‘ì„ ìœ ë°œí•  ìˆ˜ ìˆë‹¤.
// ì½”ë“œ 78-1 ì˜ëª»ëœ ì½”ë“œ - ì´ í”„ë¡œê·¸ë¨ì€ ì–¼ë§ˆë‚˜ ì˜¤ë˜ ì‹¤í–‰ë ê¹Œ? (415ìª½) public class StopThread { private static boolean stopRequested; public static void main(String[] args) throws InterruptedException { Thread backgroundThread = new Thread(() -> { int i = 0; while (!stopRequested) i++; }); backgroundThread.start(); TimeUnit.SECONDS.sleep(1); stopRequested = true; } } ì—¬ëŸ¬ ìŠ¤ë ˆë“œê°€ ê³µìœ í•˜ëŠ” ê°€ë³€ ë°ì´í„°ë¥¼ ë™ê¸°í™”í•˜ì§€ ì•Šì„ ê²½ìš° ë‹¤ë¥¸ ìŠ¤ë ˆë“œì—ì„œ ë³€ê²½í•œ ê°’ì„ ì–¸ì œ ë³´ê²Œ ë  ì§€ ì•Œ ìˆ˜ ì—†ë‹¤."><meta property="og:type" content="article"><meta property="og:url" content="https://junbread.win/posts/2021/effective-java-11/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-08-16T00:00:00+00:00"><meta property="article:modified_time" content="2021-08-16T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="ì´í™í‹°ë¸Œ ìë°” 11ì¥ ì •ë¦¬"><meta name=twitter:description content="ì•„ì´í…œ 78: ê³µìœ  ì¤‘ì¸ ê°€ë³€ ë°ì´í„°ëŠ” ë™ê¸°í™”í•´ ì‚¬ìš©í•˜ë¼ ì—¬ëŸ¬ ìŠ¤ë ˆë“œê°€ í•˜ë‚˜ì˜ ê°€ë³€ ë°ì´í„°ë¥¼ ì‚¬ìš©í•  ë•Œì— ì…ì¶œë ¥ ì‹œ ë™ê¸°í™”ì— ì‹ ê²½ì“°ì§€ ì•ŠëŠ”ë‹¤ë©´ ì˜ëª»ëœ ë™ì‘ì„ ìœ ë°œí•  ìˆ˜ ìˆë‹¤.
// ì½”ë“œ 78-1 ì˜ëª»ëœ ì½”ë“œ - ì´ í”„ë¡œê·¸ë¨ì€ ì–¼ë§ˆë‚˜ ì˜¤ë˜ ì‹¤í–‰ë ê¹Œ? (415ìª½) public class StopThread { private static boolean stopRequested; public static void main(String[] args) throws InterruptedException { Thread backgroundThread = new Thread(() -> { int i = 0; while (!stopRequested) i++; }); backgroundThread.start(); TimeUnit.SECONDS.sleep(1); stopRequested = true; } } ì—¬ëŸ¬ ìŠ¤ë ˆë“œê°€ ê³µìœ í•˜ëŠ” ê°€ë³€ ë°ì´í„°ë¥¼ ë™ê¸°í™”í•˜ì§€ ì•Šì„ ê²½ìš° ë‹¤ë¥¸ ìŠ¤ë ˆë“œì—ì„œ ë³€ê²½í•œ ê°’ì„ ì–¸ì œ ë³´ê²Œ ë  ì§€ ì•Œ ìˆ˜ ì—†ë‹¤."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://junbread.win/posts/"},{"@type":"ListItem","position":3,"name":"ì´í™í‹°ë¸Œ ìë°” 11ì¥ ì •ë¦¬","item":"https://junbread.win/posts/2021/effective-java-11/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"ì´í™í‹°ë¸Œ ìë°” 11ì¥ ì •ë¦¬","name":"ì´í™í‹°ë¸Œ ìë°” 11ì¥ ì •ë¦¬","description":"ì•„ì´í…œ 78: ê³µìœ  ì¤‘ì¸ ê°€ë³€ ë°ì´í„°ëŠ” ë™ê¸°í™”í•´ ì‚¬ìš©í•˜ë¼ ì—¬ëŸ¬ ìŠ¤ë ˆë“œê°€ í•˜ë‚˜ì˜ ê°€ë³€ ë°ì´í„°ë¥¼ ì‚¬ìš©í•  ë•Œì— ì…ì¶œë ¥ ì‹œ ë™ê¸°í™”ì— ì‹ ê²½ì“°ì§€ ì•ŠëŠ”ë‹¤ë©´ ì˜ëª»ëœ ë™ì‘ì„ ìœ ë°œí•  ìˆ˜ ìˆë‹¤.\n// ì½”ë“œ 78-1 ì˜ëª»ëœ ì½”ë“œ - ì´ í”„ë¡œê·¸ë¨ì€ ì–¼ë§ˆë‚˜ ì˜¤ë˜ ì‹¤í–‰ë ê¹Œ? (415ìª½) public class StopThread { private static boolean stopRequested; public static void main(String[] args) throws InterruptedException { Thread backgroundThread = new Thread(() -\u0026gt; { int i = 0; while (!stopRequested) i++; }); backgroundThread.start(); TimeUnit.SECONDS.sleep(1); stopRequested = true; } } ì—¬ëŸ¬ ìŠ¤ë ˆë“œê°€ ê³µìœ í•˜ëŠ” ê°€ë³€ ë°ì´í„°ë¥¼ ë™ê¸°í™”í•˜ì§€ ì•Šì„ ê²½ìš° ë‹¤ë¥¸ ìŠ¤ë ˆë“œì—ì„œ ë³€ê²½í•œ ê°’ì„ ì–¸ì œ ë³´ê²Œ ë  ì§€ ì•Œ ìˆ˜ ì—†ë‹¤.","keywords":["Study","Java"],"articleBody":"ì•„ì´í…œ 78: ê³µìœ  ì¤‘ì¸ ê°€ë³€ ë°ì´í„°ëŠ” ë™ê¸°í™”í•´ ì‚¬ìš©í•˜ë¼ ì—¬ëŸ¬ ìŠ¤ë ˆë“œê°€ í•˜ë‚˜ì˜ ê°€ë³€ ë°ì´í„°ë¥¼ ì‚¬ìš©í•  ë•Œì— ì…ì¶œë ¥ ì‹œ ë™ê¸°í™”ì— ì‹ ê²½ì“°ì§€ ì•ŠëŠ”ë‹¤ë©´ ì˜ëª»ëœ ë™ì‘ì„ ìœ ë°œí•  ìˆ˜ ìˆë‹¤.\n// ì½”ë“œ 78-1 ì˜ëª»ëœ ì½”ë“œ - ì´ í”„ë¡œê·¸ë¨ì€ ì–¼ë§ˆë‚˜ ì˜¤ë˜ ì‹¤í–‰ë ê¹Œ? (415ìª½) public class StopThread { private static boolean stopRequested; public static void main(String[] args) throws InterruptedException { Thread backgroundThread = new Thread(() -\u003e { int i = 0; while (!stopRequested) i++; }); backgroundThread.start(); TimeUnit.SECONDS.sleep(1); stopRequested = true; } } ì—¬ëŸ¬ ìŠ¤ë ˆë“œê°€ ê³µìœ í•˜ëŠ” ê°€ë³€ ë°ì´í„°ë¥¼ ë™ê¸°í™”í•˜ì§€ ì•Šì„ ê²½ìš° ë‹¤ë¥¸ ìŠ¤ë ˆë“œì—ì„œ ë³€ê²½í•œ ê°’ì„ ì–¸ì œ ë³´ê²Œ ë  ì§€ ì•Œ ìˆ˜ ì—†ë‹¤. ì»´íŒŒì¼ëŸ¬ ìµœì í™” ìˆ˜í–‰ ê²°ê³¼ ì˜ë„í•˜ì§€ ì•Šì€ ëŒ€ë¡œ ë™ì‘í•  ìˆ˜ë„ ìˆë‹¤. ë©€í‹° ìŠ¤ë ˆë“œ í™˜ê²½ì—ì„œ ê°€ë³€ ê³µìœ  ë°ì´í„°ë¥¼ ë‹¤ë£¨ëŠ” ë°©ë²• ë©€í‹°ìŠ¤ë ˆë“œì—ì„œ ê°€ë³€ ë°ì´í„°ë¥¼ ê³µìœ í•˜ì§€ ë§ì. (ìµœì„ ) â†’ synchronized ë¥¼ ì‚¬ìš©í•´ ë™ê¸°í™”í•˜ì.\në™ê¸°í™” ì‹œì—ëŠ” ì½ê¸°ì™€ ì“°ê¸° ëª¨ë‘ë¥¼ ë™ê¸°í™”í•´ì•¼ í•œë‹¤.\nprivate static boolean stopRequested; private static synchronized void requestStop() { stopRequested = true; } private static synchronized boolean stopRequested() { return stopRequested; } â†’ volatile ì„ ì‚¬ìš©í•˜ë©´ í•­ìƒ ê°€ì¥ ìµœê·¼ì— ê¸°ë¡ëœ ê°’ì„ ì½ë„ë¡ ë³´ì¦í•œë‹¤. (ë©”ëª¨ë¦¬ ì ‘ê·¼)\nprivate static volatile boolean stopRequested; í•˜ì§€ë§Œ ì›ìì ì´ì§€ ì•Šì€ ì—°ì‚° ìˆ˜í–‰ ì‹œì—ëŠ” ë™ê¸°í™”í•´ì•¼ í•˜ë©°, í•˜ì§€ ì•Šì„ ê²½ìš° ì•ˆì „ ì‹¤íŒ¨ê°€ ë°œìƒí•  ê°€ëŠ¥ì„±ì´ ìˆë‹¤. â†’ java.util.concurrentì—ì„œ ì œê³µí•˜ëŠ” Atomic* ìë£Œêµ¬ì¡°ë¥¼ ì‚¬ìš©í•˜ë©´, ë™ê¸°í™” ë½ ì—†ì´ë„ ìŠ¤ë ˆë“œ ì•ˆì „í•˜ê²Œ êµ¬í˜„ì´ ê°€ëŠ¥í•˜ë‹¤.\nì•„ì´í…œ 79: ê³¼ë„í•œ ë™ê¸°í™”ëŠ” í”¼í•˜ë¼ ë„ˆë¬´ ê³¼í•œ ë™ê¸°í™”ëŠ” ì„±ëŠ¥ì„ ë–¨ì–´ëœ¨ë¦¬ê³  ë°ë“œë½ì„ ìœ ë°œí•˜ê±°ë‚˜, ì•ˆì „ ì‹¤íŒ¨ì˜ ì›ì¸ì´ ëœë‹¤.\nì‘ë‹µ ë¶ˆê°€ë‚˜ ì•ˆì „ ì‹¤íŒ¨ë¥¼ í”¼í•˜ë ¤ë©´ ë™ê¸°í™” ë©”ì„œë“œë‚˜ ë™ê¸°í™” ë¸”ëŸ­ ì•ˆì—ì„œëŠ” ì œì–´ë¥¼ í´ë¼ì´ì–¸íŠ¸ì— ì–‘ë„í•´ì„œëŠ” ì•ˆëœë‹¤.\nì™¸ê³„ì¸(?) ë©”ì„œë“œ\n// ì½”ë“œ 79-1 ì˜ëª»ëœ ì½”ë“œ. ë™ê¸°í™” ë¸”ë¡ ì•ˆì—ì„œ ì™¸ê³„ì¸ ë©”ì„œë“œë¥¼ í˜¸ì¶œí•œë‹¤. (420ìª½) private final List\u003cSetObserver\u003cE\u003e\u003e observers = new ArrayList\u003c\u003e(); public void addObserver(SetObserver\u003cE\u003e observer) { synchronized(observers) { observers.add(observer); } } public boolean removeObserver(SetObserver\u003cE\u003e observer) { synchronized(observers) { return observers.remove(observer); } } private void notifyElementAdded(E element) { synchronized(observers) { for (SetObserver\u003cE\u003e observer : observers) observer.added(this, element); } } ... public class Test2 { public static void main(String[] args) { ObservableSet\u003cInteger\u003e set = new ObservableSet\u003c\u003e(new HashSet\u003c\u003e()); set.addObserver(new SetObserver\u003c\u003e() { public void added(ObservableSet\u003cInteger\u003e s, Integer e) { System.out.println(e); if (e == 23) // ê°’ì´ 23ì´ë©´ ìì‹ ì„ êµ¬ë…í•´ì§€í•œë‹¤. s.removeObserver(this); } }); for (int i = 0; i \u003c 100; i++) set.add(i); } } í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì‹œ ConcurrentModificationException ë°œìƒ!\nâ†’ ë™ê¸°í™” ë¸”ëŸ­ ì•ˆì—ì„œ í´ë¼ì´ì–¸íŠ¸ ë©”ì„œë“œê°€ í˜¸ì¶œë˜ì—ˆê¸° ë•Œë¬¸ì— synchronizedì˜ ë³´í˜¸ë¥¼ ë°›ì§€ ëª»í•œë‹¤.\n// ì½”ë“œ 79-3 ì™¸ê³„ì¸ ë©”ì„œë“œë¥¼ ë™ê¸°í™” ë¸”ë¡ ë°”ê¹¥ìœ¼ë¡œ ì˜®ê²¼ë‹¤. - ì—´ë¦° í˜¸ì¶œ (424ìª½) private void notifyElementAdded(E element) { List\u003cSetObserver\u003cE\u003e\u003e snapshot = null; synchronized(observers) { snapshot = new ArrayList\u003c\u003e(observers); } for (SetObserver\u003cE\u003e observer : snapshot) observer.added(this, element); } // ì½”ë“œ 79-4 CopyOnWriteArrayListë¥¼ ì‚¬ìš©í•´ êµ¬í˜„í•œ ìŠ¤ë ˆë“œ ì•ˆì „í•˜ê³  ê´€ì°° ê°€ëŠ¥í•œ ì§‘í•© (425ìª½) private final List\u003cSetObserver\u003cE\u003e\u003e observers = new CopyOnWriteArrayList\u003c\u003e(); public void addObserver(SetObserver\u003cE\u003e observer) { observers.add(observer); } public boolean removeObserver(SetObserver\u003cE\u003e observer) { return observers.remove(observer); } private void notifyElementAdded(E element) { for (SetObserver\u003cE\u003e observer : observers) observer.added(this, element); } @Override public boolean add(E element) { boolean added = super.add(element); if (added) notifyElementAdded(element); return added; } @Override public boolean addAll(Collection\u003c? extends E\u003e c) { boolean result = false; for (E element : c) result |= add(element); // notifyElementAddedë¥¼ í˜¸ì¶œí•œë‹¤. return result; } ë™ê¸°í™” ì˜ì—­ì€ ìµœëŒ€í•œ ì‘ê²Œ ê°€ì ¸ê°€ì.\ní•©ë‹¹í•œ ì´ìœ ê°€ ìˆì„ ë•Œë§Œ ë‚´ë¶€ì—ì„œ ë™ê¸°í™”í•˜ê³ , ë™ê¸°í™” ì—¬ë¶€ë¥¼ ë¬¸ì„œì— ëª…í™•íˆ ë°íˆì.\nì•„ì´í…œ 80: ìŠ¤ë ˆë“œë³´ë‹¤ëŠ” ì‹¤í–‰ì, íƒœìŠ¤í¬, ìŠ¤íŠ¸ë¦¼ì„ ì• ìš©í•˜ë¼ ì‘ì—… íë¥¼ ë§Œë“¤ê¸° ìœ„í•´ ìŠ¤ë ˆë“œë¥¼ ì§ì ‘ ë‹¤ë£¨ê¸°ë³´ë‹¤ëŠ” java.util.concurrent í•˜ìœ„ì˜ ì‹¤í–‰ì í”„ë ˆì„ì›Œí¬ë¥¼ ì´ìš©í•˜ì.\nExecutorService exec = Executors.newSingleThreadExecutor(); exec.execute(runnable); exec.shutdown(); ì‹¤í–‰ì í”„ë ˆì„ì›Œí¬ì˜ ê¸°ëŠ¥ íŠ¹ì • íƒœìŠ¤í¬ ì™„ë£Œ ëŒ€ê¸° íƒœìŠ¤í¬ ëª¨ìŒ ì¤‘ ì•„ë¬´ê±°ë‚˜ í•˜ë‚˜, í˜¹ì€ ëª¨ë“  íƒœìŠ¤í¬ ì™„ë£Œ ëŒ€ê¸° ì‹¤í–‰ì ì„œë¹„ìŠ¤ ì¢…ë£Œ ëŒ€ê¸° ì™„ë£Œëœ íƒœìŠ¤í¬ì˜ ê²°ê³¼ë¥¼ ì°¨ë¡€ë¡œ ë°›ê¸° íƒœìŠ¤í¬ë¥¼ íŠ¹ì • ì‹œê°„, í˜¹ì€ ì£¼ê¸°ë¡œ ì‹¤í–‰í•˜ê¸° í”„ë¡œê·¸ë¨ ê·œëª¨ì— ë”°ë¼ ê°ê° ë‹¤ë¥¸ ìŠ¤ë ˆë“œ ê´€ë¦¬ ë©”ì»¤ë‹ˆì¦˜ì„ ì‚¬ìš©í•˜ëŠ” ì‹¤í–‰ì ì„œë¹„ìŠ¤ë¥¼ ìƒì„±í•  ìˆ˜ ìˆë‹¤.\nex) Executors.newCachedThreadPool, Executors.newFixedThreadPool, â€¦\nìë°” 7ë¶€í„°ëŠ” ForkJoinPoolì„ ì§€ì›í•˜ë„ë¡ ê°œëŸ‰ë˜ì–´ì„œ íš¨ìœ¨ì„±ì´ ê°œì„ ë˜ì—ˆë‹¤.\nì•„ì´í…œ 81: waitê³¼ notifyë³´ë‹¤ëŠ” ë™ì‹œì„± ìœ í‹¸ë¦¬í‹°ë¥¼ ì• ìš©í•˜ë¼ waitê³¼ notifyëŠ” ì˜¬ë°”ë¥´ê²Œ ì‚¬ìš©í•˜ê¸° ë§¤ìš° ì–´ë ¤ìš°ë¯€ë¡œ, ê³ ìˆ˜ì¤€ ë™ì‹œì„± ìœ í‹¸ë¦¬í‹°ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì¢‹ë‹¤.\nê³ ìˆ˜ì¤€ ë™ì‹œì„± ìœ í‹¸ë¦¬í‹°ì˜ ì¢…ë¥˜ ì‹¤í–‰ì í”„ë ˆì„ì›Œí¬ ë™ì‹œì„± ì»¬ë ‰ì…˜ ConcurrentHashMap ë“± ë‚´ë¶€ì—ì„œ ë™ê¸°í™”ë¥¼ íš¨ìœ¨ì ìœ¼ë¡œ êµ¬í˜„í•œ ì»¬ë ‰ì…˜ ìƒíƒœ ì˜ì¡´ì  ë©”ì„œë“œë“¤ì´ ì¶”ê°€ë˜ì–´ ìˆìŒ ex) putIfAbsent ë™ê¸°í™” ì¥ì¹˜ CountDownLatch, Semaphore, â€¦ // ì½”ë“œ 81-3 ë™ì‹œ ì‹¤í–‰ ì‹œê°„ì„ ì¬ëŠ” ê°„ë‹¨í•œ í”„ë ˆì„ì›Œí¬ (433-434ìª½) public class ConcurrentTimer { private ConcurrentTimer() { } // ì¸ìŠ¤í„´ìŠ¤ ìƒì„± ë¶ˆê°€ public static long time(Executor executor, int concurrency, Runnable action) throws InterruptedException { CountDownLatch ready = new CountDownLatch(concurrency); CountDownLatch start = new CountDownLatch(1); CountDownLatch done = new CountDownLatch(concurrency); for (int i = 0; i \u003c concurrency; i++) { executor.execute(() -\u003e { ready.countDown(); // íƒ€ì´ë¨¸ì—ê²Œ ì¤€ë¹„ë¥¼ ë§ˆì³¤ìŒì„ ì•Œë¦°ë‹¤. try { start.await(); // ëª¨ë“  ì‘ì—…ì ìŠ¤ë ˆë“œê°€ ì¤€ë¹„ë  ë•Œê¹Œì§€ ê¸°ë‹¤ë¦°ë‹¤. action.run(); } catch (InterruptedException e) { Thread.currentThread().interrupt(); } finally { done.countDown(); // íƒ€ì´ë¨¸ì—ê²Œ ì‘ì—…ì„ ë§ˆì³¤ìŒì„ ì•Œë¦°ë‹¤. } }); } ready.await(); // ëª¨ë“  ì‘ì—…ìê°€ ì¤€ë¹„ë  ë•Œê¹Œì§€ ê¸°ë‹¤ë¦°ë‹¤. long startNanos = System.nanoTime(); start.countDown(); // ì‘ì—…ìë“¤ì„ ê¹¨ìš´ë‹¤. done.await(); // ëª¨ë“  ì‘ì—…ìê°€ ì¼ì„ ëë§ˆì¹˜ê¸°ë¥¼ ê¸°ë‹¤ë¦°ë‹¤. return System.nanoTime() - startNanos; } } ì–´ì©” ìˆ˜ ì—†ì´ wait/notifyë¥¼ ì‚¬ìš©í•´ì•¼ í•  ë•Œì—ëŠ” wait í˜¸ì¶œ ì‹œ while ë¬¸ ì•ˆì—ì„œë§Œ í˜¸ì¶œí•˜ëŠ” í‘œì¤€ ë°©ì‹ì„ ë”°ë¥´ì.\nsynchronized (obj) { while (\u003cì¡°ê±´ì´ ì¶©ì¡±ë˜ì§€ ì•Šì•˜ë‹¤\u003e) obj.wait(); // (ë½ì„ ë†“ê³ , ê¹¨ì–´ë‚˜ë©´ ë‹¤ì‹œ ì¡ëŠ”ë‹¤.) ... // ì¡°ê±´ì´ ì¶©ì¡±ëì„ ë•Œì˜ ë™ì‘ì„ ìˆ˜í–‰í•œë‹¤. } ì•„ì´í…œ 82: ìŠ¤ë ˆë“œ ì•ˆì „ì„± ìˆ˜ì¤€ì„ ë¬¸ì„œí™”í•˜ë¼ ë©€í‹°ìŠ¤ë ˆë“œ í™˜ê²½ì—ì„œ APIë¥¼ ì•ˆì „í•˜ê²Œ ì‚¬ìš©í•˜ë ¤ë©´ í´ë˜ìŠ¤ê°€ ì§€ì›í•˜ëŠ” ìŠ¤ë ˆë“œ ì•ˆì „ì„± ìˆ˜ì¤€ì„ ëª…ì‹œí•´ì•¼ í•œë‹¤.\\\nìŠ¤ë ˆë“œ ì•ˆì „ì„± ìˆ˜ì¤€ ë¶ˆë³€ ë¬´ì¡°ê±´ì  ìŠ¤ë ˆë“œ ì•ˆì „: ìˆ˜ì •ë  ìˆ˜ ìˆìœ¼ë‚˜ ë‚´ë¶€ì—ì„œ ë™ê¸°í™”í•´ì„œ ë³„ë„ì˜ ì²˜ë¦¬ ì—†ì´ ìŠ¤ë ˆë“œ ì•ˆì „í•˜ê²Œ ì‚¬ìš© ê°€ëŠ¥í•˜ë‹¤. ì¡°ê±´ë¶€ ìŠ¤ë ˆë“œ ì•ˆì „: ì¼ë¶€ ìŠ¤ë ˆë“œë¥¼ ì‚¬ìš©í•˜ë ¤ë©´ ì™¸ë¶€ ë™ê¸°í™”ê°€ í•„ìš”í•˜ë‹¤. ìŠ¤ë ˆë“œ ì•ˆì „í•˜ì§€ ì•ŠìŒ: ë™ì‹œì— ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„œëŠ” ì™¸ë¶€ ë™ê¸°í™”ê°€ í•„ìš”í•˜ë‹¤. ìŠ¤ë ˆë“œ ì ëŒ€ì : ì™¸ë¶€ ë™ê¸°í™”ë¡œ ê°ì‹¸ë”ë¼ë„ ë©€í‹°ìŠ¤ë ˆë“œ í™˜ê²½ì—ì„œ ì•ˆì „í•˜ì§€ ì•Šë‹¤. (ì •ì  ë°ì´í„°ë¥¼ ë™ê¸°í™” ì—†ì´ ìˆ˜ì •í•˜ëŠ” ê²½ìš°) ì¡°ê±´ë¶€ ìŠ¤ë ˆë“œ ì•ˆì „í•œ í´ë˜ìŠ¤ëŠ” ì£¼ì˜í•´ì„œ ì–´ë–¤ ìˆœì„œë¡œ í˜¸ì¶œí•  ë•Œ ë™ê¸°í™” ë¡œì§ì´ í•„ìš”í•œì§€, ì–´ë–¤ ë½ì„ ì–»ì–´ì•¼ í•˜ëŠ”ì§€ ê¸°ìˆ í•´ì•¼ í•œë‹¤.\nê³µê°œëœ ë½ì„ ì‚¬ìš©í•˜ëŠ” ê²½ìš° í´ë¼ì´ì–¸íŠ¸ì—ì„œ ë½ì„ í’€ì§€ ì•ŠëŠ” ì„œë¹„ìŠ¤ ê±°ë¶€ ê³µê²©ì„ í•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì—, ë¹„ê³µê°œ ë½ ê°ì²´ë¥¼ ì‚¬ìš©í•˜ê³  finalë¡œ ì„ ì–¸í•˜ëŠ” ê²ƒì´ ì¢‹ë‹¤.\nì•„ì´í…œ 83: ì§€ì—° ì´ˆê¸°í™”ëŠ” ì‹ ì¤‘íˆ ì‚¬ìš©í•˜ë¼ ìƒí™©ì— ë”°ë¼ ì§€ì—° ì´ˆê¸°í™”ëŠ” ì˜¤íˆë ¤ ì„±ëŠ¥ì„ ë” ëŠë¦¬ê²Œ ë§Œë“¤ ìˆ˜ ìˆìœ¼ë¯€ë¡œ ì‹ ì¤‘íˆ ì‚¬ìš©í•´ì•¼ í•œë‹¤.\nëŒ€ë¶€ë¶„ì˜ ìƒí™©ì—ì„œëŠ” ì¼ë°˜ì ì¸ ì´ˆê¸°í™”ê°€ ì¢‹ë‹¤.\në©€í‹°ìŠ¤ë ˆë“œ í™˜ê²½ì—ì„œì˜ ì§€ì—° ì´ˆê¸°í™” ì§€ì—° ì´ˆê¸°í™”ê°€ ì´ˆê¸°í™” ìˆœí™˜ì„±ì„ ê¹¨ëœ¨ë¦´ ê²ƒ ê°™ìœ¼ë©´ synchronizedë¥¼ ë‹¨ ì ‘ê·¼ìë¥¼ ì‚¬ìš©í•˜ì.\n// ì½”ë“œ 83-2 ì¸ìŠ¤í„´ìŠ¤ í•„ë“œì˜ ì§€ì—° ì´ˆê¸°í™” - synchronized ì ‘ê·¼ì ë°©ì‹ (443ìª½) private FieldType field2; private synchronized FieldType getField2() { if (field2 == null) field2 = computeFieldValue(); return field2; } ì„±ëŠ¥ ë•Œë¬¸ì— ì •ì  í•„ë“œë¥¼ ì§€ì—° ì´ˆê¸°í™”í•´ì•¼ í•œë‹¤ë©´ ì§€ì—° ì´ˆê¸°í™” í™€ë” í´ë˜ìŠ¤ ê´€ìš©êµ¬ë¥¼ ì‚¬ìš©í•˜ì.\n// ì½”ë“œ 83-3 ì •ì  í•„ë“œìš© ì§€ì—° ì´ˆê¸°í™” í™€ë” í´ë˜ìŠ¤ ê´€ìš©êµ¬ (443ìª½) private static class FieldHolder { static final FieldType field = computeFieldValue(); } private static FieldType getField() { return FieldHolder.field; } ì„±ëŠ¥ ë•Œë¬¸ì— ì¸ìŠ¤í„´ìŠ¤ í•„ë“œë¥¼ ì§€ì—° ì´ˆê¸°í™”í•´ì•¼ í•œë‹¤ë©´ ì´ì¤‘ ê²€ì‚¬ ê´€ìš©êµ¬ë¥¼ ì‚¬ìš©í•˜ì.\nâ†’ ì´ë¯¸ ì´ˆê¸°í™”ëœ ê²½ìš° synchronized ë¸”ëŸ­ì— ì§„ì…í•˜ì§€ ì•Šì•„ì„œ ì ‘ê·¼ ë¹„ìš©ì´ ì‘ì•„ì§„ë‹¤.\n// ì½”ë“œ 83-4 ì¸ìŠ¤í„´ìŠ¤ í•„ë“œ ì§€ì—° ì´ˆê¸°í™”ìš© ì´ì¤‘ê²€ì‚¬ ê´€ìš©êµ¬ (444ìª½) private volatile FieldType field4; private FieldType getField4() { FieldType result = field4; if (result != null) // ì²« ë²ˆì§¸ ê²€ì‚¬ (ë½ ì‚¬ìš© ì•ˆ í•¨) return result; synchronized(this) { if (field4 == null) // ë‘ ë²ˆì§¸ ê²€ì‚¬ (ë½ ì‚¬ìš©) field4 = computeFieldValue(); return field4; } } ë°˜ë³µí•´ì„œ ì´ˆê¸°í™”í•´ë„ ìƒê´€ì—†ëŠ” ê²½ìš° ë™ê¸°í™” ì—†ì´ ë‹¨ì¼ ê²€ì‚¬í•´ë„ ê´œì°®ë‹¤.\nì•„ì´í…œ 84: í”„ë¡œê·¸ë¨ì˜ ë™ì‘ì„ ìŠ¤ë ˆë“œ ìŠ¤ì¼€ì¤„ëŸ¬ì— ê¸°ëŒ€ì§€ ë§ë¼ ìŠ¤ë ˆë“œ ìŠ¤ì¼€ì¤„ëŸ¬ì˜ ë™ì‘ì€ í”Œë«í¼, ìš´ì˜ì²´ì œë§ˆë‹¤ ë‹¤ë¥´ê¸° ë•Œë¬¸ì— ë‹¤ë¥¸ í”Œë«í¼ì— ì´ì‹í•˜ê¸° ì–´ë ¤ì›Œì§ˆ ìˆ˜ ìˆë‹¤.\nì‹¤í–‰ ê°€ëŠ¥í•œ ìŠ¤ë ˆë“œì˜ ìˆ˜ê°€ í”„ë¡œì„¸ìŠ¤ì˜ ìˆ˜ë³´ë‹¤ ê³¼ë„í•˜ê²Œ ë§ì•„ì„œëŠ” ì•ˆ ëœë‹¤.\nìŠ¤ë ˆë“œëŠ” ë‹¹ì¥ ì²˜ë¦¬í•´ì•¼ í•  ì‘ì—…ì´ ì—†ë‹¤ë©´ ì‹¤í–‰ë˜ì–´ì„œëŠ” ì•ˆ ëœë‹¤.\nìŠ¤ë ˆë“œëŠ” ì ˆëŒ€ ë°”ìœ ëŒ€ê¸° ìƒíƒœê°€ ë˜ì–´ì„œëŠ” ì•ˆ ëœë‹¤.\n// ì½”ë“œ 84-1 ë”ì°í•œ CountDownLatch êµ¬í˜„ - ë°”ìœ ëŒ€ê¸° ë²„ì „! (447ìª½) public class SlowCountDownLatch { private int count; public SlowCountDownLatch(int count) { if (count \u003c 0) throw new IllegalArgumentException(count + \" \u003c 0\"); this.count = count; } public void await() { while (true) { synchronized(this) { if (count == 0) return; } } } public synchronized void countDown() { if (count != 0) count--; } â†’ ì´ ë¬¸ì œë¥¼ ê³ ì¹œë‹µì‹œê³  Thread.yield ë“±ì„ ì‚¬ìš©í•œë‹¤ë©´ JVM êµ¬í˜„ì²´ë³„ë¡œ ë‹¤ë¥¸ íš¨ê³¼ì— ì´ì‹ì„±ë§Œ ë‚˜ë¹ ì§€ëŠ” ê²°ê³¼ë¥¼ ì´ˆë˜í•  ìˆ˜ ìˆë‹¤.\n","wordCount":"1232","inLanguage":"en","datePublished":"2021-08-16T00:00:00Z","dateModified":"2021-08-16T00:00:00Z","mainEntityOfPage":{"@type":"WebPage","@id":"https://junbread.win/posts/2021/effective-java-11/"},"publisher":{"@type":"Organization","name":"JunbreadğŸ¥","logo":{"@type":"ImageObject","url":"https://junbread.win/favicon.ico"}}}</script></head><body id=top><script>window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://junbread.win accesskey=h title="JunbreadğŸ¥ (Alt + H)">JunbreadğŸ¥</a><div class=logo-switches></div></div><ul id=menu><li><a href=https://junbread.win/about title=About><span>About</span></a></li><li><a href=https://junbread.win/archives/ title=ì•„ì¹´ì´ë¸Œ><span>ì•„ì¹´ì´ë¸Œ</span></a></li><li><a href=https://junbread.win/tags/ title=íƒœê·¸><span>íƒœê·¸</span></a></li><li><a href=https://junbread.win/search/ title="ê²€ìƒ‰ (Alt + /)" accesskey=/><span>ê²€ìƒ‰</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://junbread.win>Home</a>&nbsp;Â»&nbsp;<a href=https://junbread.win/posts/>Posts</a></div><h1 class=post-title>ì´í™í‹°ë¸Œ ìë°” 11ì¥ ì •ë¦¬</h1><div class=post-meta><span title='2021-08-16 00:00:00 +0000 UTC'>August 16, 2021</span>&nbsp;Â·&nbsp;6 min</div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#%ec%95%84%ec%9d%b4%ed%85%9c-78-%ea%b3%b5%ec%9c%a0-%ec%a4%91%ec%9d%b8-%ea%b0%80%eb%b3%80-%eb%8d%b0%ec%9d%b4%ed%84%b0%eb%8a%94-%eb%8f%99%ea%b8%b0%ed%99%94%ed%95%b4-%ec%82%ac%ec%9a%a9%ed%95%98%eb%9d%bc aria-label="ì•„ì´í…œ 78: ê³µìœ  ì¤‘ì¸ ê°€ë³€ ë°ì´í„°ëŠ” ë™ê¸°í™”í•´ ì‚¬ìš©í•˜ë¼">ì•„ì´í…œ 78: ê³µìœ  ì¤‘ì¸ ê°€ë³€ ë°ì´í„°ëŠ” ë™ê¸°í™”í•´ ì‚¬ìš©í•˜ë¼</a><ul><li><a href=#%eb%a9%80%ed%8b%b0-%ec%8a%a4%eb%a0%88%eb%93%9c-%ed%99%98%ea%b2%bd%ec%97%90%ec%84%9c-%ea%b0%80%eb%b3%80-%ea%b3%b5%ec%9c%a0-%eb%8d%b0%ec%9d%b4%ed%84%b0%eb%a5%bc-%eb%8b%a4%eb%a3%a8%eb%8a%94-%eb%b0%a9%eb%b2%95 aria-label="ë©€í‹° ìŠ¤ë ˆë“œ í™˜ê²½ì—ì„œ ê°€ë³€ ê³µìœ  ë°ì´í„°ë¥¼ ë‹¤ë£¨ëŠ” ë°©ë²•">ë©€í‹° ìŠ¤ë ˆë“œ í™˜ê²½ì—ì„œ ê°€ë³€ ê³µìœ  ë°ì´í„°ë¥¼ ë‹¤ë£¨ëŠ” ë°©ë²•</a></li></ul></li><li><a href=#%ec%95%84%ec%9d%b4%ed%85%9c-79-%ea%b3%bc%eb%8f%84%ed%95%9c-%eb%8f%99%ea%b8%b0%ed%99%94%eb%8a%94-%ed%94%bc%ed%95%98%eb%9d%bc aria-label="ì•„ì´í…œ 79: ê³¼ë„í•œ ë™ê¸°í™”ëŠ” í”¼í•˜ë¼">ì•„ì´í…œ 79: ê³¼ë„í•œ ë™ê¸°í™”ëŠ” í”¼í•˜ë¼</a></li><li><a href=#%ec%95%84%ec%9d%b4%ed%85%9c-80-%ec%8a%a4%eb%a0%88%eb%93%9c%eb%b3%b4%eb%8b%a4%eb%8a%94-%ec%8b%a4%ed%96%89%ec%9e%90-%ed%83%9c%ec%8a%a4%ed%81%ac-%ec%8a%a4%ed%8a%b8%eb%a6%bc%ec%9d%84-%ec%95%a0%ec%9a%a9%ed%95%98%eb%9d%bc aria-label="ì•„ì´í…œ 80: ìŠ¤ë ˆë“œë³´ë‹¤ëŠ” ì‹¤í–‰ì, íƒœìŠ¤í¬, ìŠ¤íŠ¸ë¦¼ì„ ì• ìš©í•˜ë¼">ì•„ì´í…œ 80: ìŠ¤ë ˆë“œë³´ë‹¤ëŠ” ì‹¤í–‰ì, íƒœìŠ¤í¬, ìŠ¤íŠ¸ë¦¼ì„ ì• ìš©í•˜ë¼</a><ul><li><a href=#%ec%8b%a4%ed%96%89%ec%9e%90-%ed%94%84%eb%a0%88%ec%9e%84%ec%9b%8c%ed%81%ac%ec%9d%98-%ea%b8%b0%eb%8a%a5 aria-label="ì‹¤í–‰ì í”„ë ˆì„ì›Œí¬ì˜ ê¸°ëŠ¥">ì‹¤í–‰ì í”„ë ˆì„ì›Œí¬ì˜ ê¸°ëŠ¥</a></li></ul></li><li><a href=#%ec%95%84%ec%9d%b4%ed%85%9c-81-wait%ea%b3%bc-notify%eb%b3%b4%eb%8b%a4%eb%8a%94-%eb%8f%99%ec%8b%9c%ec%84%b1-%ec%9c%a0%ed%8b%b8%eb%a6%ac%ed%8b%b0%eb%a5%bc-%ec%95%a0%ec%9a%a9%ed%95%98%eb%9d%bc aria-label="ì•„ì´í…œ 81: waitê³¼ notifyë³´ë‹¤ëŠ” ë™ì‹œì„± ìœ í‹¸ë¦¬í‹°ë¥¼ ì• ìš©í•˜ë¼">ì•„ì´í…œ 81: waitê³¼ notifyë³´ë‹¤ëŠ” ë™ì‹œì„± ìœ í‹¸ë¦¬í‹°ë¥¼ ì• ìš©í•˜ë¼</a><ul><li><a href=#%ea%b3%a0%ec%88%98%ec%a4%80-%eb%8f%99%ec%8b%9c%ec%84%b1-%ec%9c%a0%ed%8b%b8%eb%a6%ac%ed%8b%b0%ec%9d%98-%ec%a2%85%eb%a5%98 aria-label="ê³ ìˆ˜ì¤€ ë™ì‹œì„± ìœ í‹¸ë¦¬í‹°ì˜ ì¢…ë¥˜">ê³ ìˆ˜ì¤€ ë™ì‹œì„± ìœ í‹¸ë¦¬í‹°ì˜ ì¢…ë¥˜</a></li></ul></li><li><a href=#%ec%95%84%ec%9d%b4%ed%85%9c-82-%ec%8a%a4%eb%a0%88%eb%93%9c-%ec%95%88%ec%a0%84%ec%84%b1-%ec%88%98%ec%a4%80%ec%9d%84-%eb%ac%b8%ec%84%9c%ed%99%94%ed%95%98%eb%9d%bc aria-label="ì•„ì´í…œ 82: ìŠ¤ë ˆë“œ ì•ˆì „ì„± ìˆ˜ì¤€ì„ ë¬¸ì„œí™”í•˜ë¼">ì•„ì´í…œ 82: ìŠ¤ë ˆë“œ ì•ˆì „ì„± ìˆ˜ì¤€ì„ ë¬¸ì„œí™”í•˜ë¼</a><ul><li><a href=#%ec%8a%a4%eb%a0%88%eb%93%9c-%ec%95%88%ec%a0%84%ec%84%b1-%ec%88%98%ec%a4%80 aria-label="ìŠ¤ë ˆë“œ ì•ˆì „ì„± ìˆ˜ì¤€">ìŠ¤ë ˆë“œ ì•ˆì „ì„± ìˆ˜ì¤€</a></li></ul></li><li><a href=#%ec%95%84%ec%9d%b4%ed%85%9c-83-%ec%a7%80%ec%97%b0-%ec%b4%88%ea%b8%b0%ed%99%94%eb%8a%94-%ec%8b%a0%ec%a4%91%ed%9e%88-%ec%82%ac%ec%9a%a9%ed%95%98%eb%9d%bc aria-label="ì•„ì´í…œ 83: ì§€ì—° ì´ˆê¸°í™”ëŠ” ì‹ ì¤‘íˆ ì‚¬ìš©í•˜ë¼">ì•„ì´í…œ 83: ì§€ì—° ì´ˆê¸°í™”ëŠ” ì‹ ì¤‘íˆ ì‚¬ìš©í•˜ë¼</a><ul><li><a href=#%eb%a9%80%ed%8b%b0%ec%8a%a4%eb%a0%88%eb%93%9c-%ed%99%98%ea%b2%bd%ec%97%90%ec%84%9c%ec%9d%98-%ec%a7%80%ec%97%b0-%ec%b4%88%ea%b8%b0%ed%99%94 aria-label="ë©€í‹°ìŠ¤ë ˆë“œ í™˜ê²½ì—ì„œì˜ ì§€ì—° ì´ˆê¸°í™”">ë©€í‹°ìŠ¤ë ˆë“œ í™˜ê²½ì—ì„œì˜ ì§€ì—° ì´ˆê¸°í™”</a></li></ul></li><li><a href=#%ec%95%84%ec%9d%b4%ed%85%9c-84-%ed%94%84%eb%a1%9c%ea%b7%b8%eb%9e%a8%ec%9d%98-%eb%8f%99%ec%9e%91%ec%9d%84-%ec%8a%a4%eb%a0%88%eb%93%9c-%ec%8a%a4%ec%bc%80%ec%a4%84%eb%9f%ac%ec%97%90-%ea%b8%b0%eb%8c%80%ec%a7%80-%eb%a7%90%eb%9d%bc aria-label="ì•„ì´í…œ 84: í”„ë¡œê·¸ë¨ì˜ ë™ì‘ì„ ìŠ¤ë ˆë“œ ìŠ¤ì¼€ì¤„ëŸ¬ì— ê¸°ëŒ€ì§€ ë§ë¼">ì•„ì´í…œ 84: í”„ë¡œê·¸ë¨ì˜ ë™ì‘ì„ ìŠ¤ë ˆë“œ ìŠ¤ì¼€ì¤„ëŸ¬ì— ê¸°ëŒ€ì§€ ë§ë¼</a></li></ul></div></details></div><div class=post-content><h2 id=ì•„ì´í…œ-78-ê³µìœ -ì¤‘ì¸-ê°€ë³€-ë°ì´í„°ëŠ”-ë™ê¸°í™”í•´-ì‚¬ìš©í•˜ë¼>ì•„ì´í…œ 78: ê³µìœ  ì¤‘ì¸ ê°€ë³€ ë°ì´í„°ëŠ” ë™ê¸°í™”í•´ ì‚¬ìš©í•˜ë¼<a hidden class=anchor aria-hidden=true href=#ì•„ì´í…œ-78-ê³µìœ -ì¤‘ì¸-ê°€ë³€-ë°ì´í„°ëŠ”-ë™ê¸°í™”í•´-ì‚¬ìš©í•˜ë¼>#</a></h2><p>ì—¬ëŸ¬ ìŠ¤ë ˆë“œê°€ í•˜ë‚˜ì˜ ê°€ë³€ ë°ì´í„°ë¥¼ ì‚¬ìš©í•  ë•Œì— ì…ì¶œë ¥ ì‹œ ë™ê¸°í™”ì— ì‹ ê²½ì“°ì§€ ì•ŠëŠ”ë‹¤ë©´ ì˜ëª»ëœ ë™ì‘ì„ ìœ ë°œí•  ìˆ˜ ìˆë‹¤.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>// ì½”ë“œ 78-1 ì˜ëª»ëœ ì½”ë“œ - ì´ í”„ë¡œê·¸ë¨ì€ ì–¼ë§ˆë‚˜ ì˜¤ë˜ ì‹¤í–‰ë ê¹Œ? (415ìª½)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>StopThread</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>boolean</span> stopRequested<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>main</span><span style=color:#f92672>(</span>String<span style=color:#f92672>[]</span> args<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>throws</span> InterruptedException <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        Thread backgroundThread <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Thread<span style=color:#f92672>(()</span> <span style=color:#f92672>-&gt;</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>int</span> i <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>while</span> <span style=color:#f92672>(!</span>stopRequested<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>                i<span style=color:#f92672>++;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>});</span>
</span></span><span style=display:flex><span>        backgroundThread<span style=color:#f92672>.</span><span style=color:#a6e22e>start</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        TimeUnit<span style=color:#f92672>.</span><span style=color:#a6e22e>SECONDS</span><span style=color:#f92672>.</span><span style=color:#a6e22e>sleep</span><span style=color:#f92672>(</span><span style=color:#ae81ff>1</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        stopRequested <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><ul><li>ì—¬ëŸ¬ ìŠ¤ë ˆë“œê°€ ê³µìœ í•˜ëŠ” ê°€ë³€ ë°ì´í„°ë¥¼ ë™ê¸°í™”í•˜ì§€ ì•Šì„ ê²½ìš° ë‹¤ë¥¸ ìŠ¤ë ˆë“œì—ì„œ ë³€ê²½í•œ ê°’ì„ ì–¸ì œ ë³´ê²Œ ë  ì§€ ì•Œ ìˆ˜ ì—†ë‹¤.</li><li>ì»´íŒŒì¼ëŸ¬ ìµœì í™” ìˆ˜í–‰ ê²°ê³¼ ì˜ë„í•˜ì§€ ì•Šì€ ëŒ€ë¡œ ë™ì‘í•  ìˆ˜ë„ ìˆë‹¤.</li></ul><h3 id=ë©€í‹°-ìŠ¤ë ˆë“œ-í™˜ê²½ì—ì„œ-ê°€ë³€-ê³µìœ -ë°ì´í„°ë¥¼-ë‹¤ë£¨ëŠ”-ë°©ë²•>ë©€í‹° ìŠ¤ë ˆë“œ í™˜ê²½ì—ì„œ ê°€ë³€ ê³µìœ  ë°ì´í„°ë¥¼ ë‹¤ë£¨ëŠ” ë°©ë²•<a hidden class=anchor aria-hidden=true href=#ë©€í‹°-ìŠ¤ë ˆë“œ-í™˜ê²½ì—ì„œ-ê°€ë³€-ê³µìœ -ë°ì´í„°ë¥¼-ë‹¤ë£¨ëŠ”-ë°©ë²•>#</a></h3><ul><li>ë©€í‹°ìŠ¤ë ˆë“œì—ì„œ ê°€ë³€ ë°ì´í„°ë¥¼ ê³µìœ í•˜ì§€ ë§ì. (ìµœì„ )</li></ul><p>â†’ <code>synchronized</code> ë¥¼ ì‚¬ìš©í•´ ë™ê¸°í™”í•˜ì.</p><p>ë™ê¸°í™” ì‹œì—ëŠ” <strong>ì½ê¸°ì™€ ì“°ê¸° ëª¨ë‘</strong>ë¥¼ ë™ê¸°í™”í•´ì•¼ í•œë‹¤.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>boolean</span> stopRequested<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>synchronized</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>requestStop</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        stopRequested <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>synchronized</span> <span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>stopRequested</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> stopRequested<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span></code></pre></div><p>â†’ <code>volatile</code> ì„ ì‚¬ìš©í•˜ë©´ í•­ìƒ ê°€ì¥ ìµœê·¼ì— ê¸°ë¡ëœ ê°’ì„ ì½ë„ë¡ ë³´ì¦í•œë‹¤. (ë©”ëª¨ë¦¬ ì ‘ê·¼)</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>volatile</span> <span style=color:#66d9ef>boolean</span> stopRequested<span style=color:#f92672>;</span>
</span></span></code></pre></div><ul><li>í•˜ì§€ë§Œ ì›ìì ì´ì§€ ì•Šì€ ì—°ì‚° ìˆ˜í–‰ ì‹œì—ëŠ” ë™ê¸°í™”í•´ì•¼ í•˜ë©°, í•˜ì§€ ì•Šì„ ê²½ìš° <strong>ì•ˆì „ ì‹¤íŒ¨</strong>ê°€ ë°œìƒí•  ê°€ëŠ¥ì„±ì´ ìˆë‹¤.</li></ul><p>â†’ java.util.concurrentì—ì„œ ì œê³µí•˜ëŠ” Atomic* ìë£Œêµ¬ì¡°ë¥¼ ì‚¬ìš©í•˜ë©´, ë™ê¸°í™” ë½ ì—†ì´ë„ ìŠ¤ë ˆë“œ ì•ˆì „í•˜ê²Œ êµ¬í˜„ì´ ê°€ëŠ¥í•˜ë‹¤.</p><h2 id=ì•„ì´í…œ-79-ê³¼ë„í•œ-ë™ê¸°í™”ëŠ”-í”¼í•˜ë¼>ì•„ì´í…œ 79: ê³¼ë„í•œ ë™ê¸°í™”ëŠ” í”¼í•˜ë¼<a hidden class=anchor aria-hidden=true href=#ì•„ì´í…œ-79-ê³¼ë„í•œ-ë™ê¸°í™”ëŠ”-í”¼í•˜ë¼>#</a></h2><p>ë„ˆë¬´ ê³¼í•œ ë™ê¸°í™”ëŠ” ì„±ëŠ¥ì„ ë–¨ì–´ëœ¨ë¦¬ê³  ë°ë“œë½ì„ ìœ ë°œí•˜ê±°ë‚˜, ì•ˆì „ ì‹¤íŒ¨ì˜ ì›ì¸ì´ ëœë‹¤.</p><ul><li><p>ì‘ë‹µ ë¶ˆê°€ë‚˜ ì•ˆì „ ì‹¤íŒ¨ë¥¼ í”¼í•˜ë ¤ë©´ ë™ê¸°í™” ë©”ì„œë“œë‚˜ ë™ê¸°í™” ë¸”ëŸ­ ì•ˆì—ì„œëŠ” ì œì–´ë¥¼ í´ë¼ì´ì–¸íŠ¸ì— ì–‘ë„í•´ì„œëŠ” ì•ˆëœë‹¤.</p><ul><li><p>ì™¸ê³„ì¸(?) ë©”ì„œë“œ</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>// ì½”ë“œ 79-1 ì˜ëª»ëœ ì½”ë“œ. ë™ê¸°í™” ë¸”ë¡ ì•ˆì—ì„œ ì™¸ê³„ì¸ ë©”ì„œë“œë¥¼ í˜¸ì¶œí•œë‹¤. (420ìª½)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> List<span style=color:#f92672>&lt;</span>SetObserver<span style=color:#f92672>&lt;</span>E<span style=color:#f92672>&gt;&gt;</span> observers
</span></span><span style=display:flex><span>        <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> ArrayList<span style=color:#f92672>&lt;&gt;();</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>addObserver</span><span style=color:#f92672>(</span>SetObserver<span style=color:#f92672>&lt;</span>E<span style=color:#f92672>&gt;</span> observer<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>synchronized</span><span style=color:#f92672>(</span>observers<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        observers<span style=color:#f92672>.</span><span style=color:#a6e22e>add</span><span style=color:#f92672>(</span>observer<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>removeObserver</span><span style=color:#f92672>(</span>SetObserver<span style=color:#f92672>&lt;</span>E<span style=color:#f92672>&gt;</span> observer<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>synchronized</span><span style=color:#f92672>(</span>observers<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> observers<span style=color:#f92672>.</span><span style=color:#a6e22e>remove</span><span style=color:#f92672>(</span>observer<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>private</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>notifyElementAdded</span><span style=color:#f92672>(</span>E element<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>synchronized</span><span style=color:#f92672>(</span>observers<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> <span style=color:#f92672>(</span>SetObserver<span style=color:#f92672>&lt;</span>E<span style=color:#f92672>&gt;</span> observer <span style=color:#f92672>:</span> observers<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>            observer<span style=color:#f92672>.</span><span style=color:#a6e22e>added</span><span style=color:#f92672>(</span><span style=color:#66d9ef>this</span><span style=color:#f92672>,</span> element<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>...</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Test2</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>main</span><span style=color:#f92672>(</span>String<span style=color:#f92672>[]</span> args<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        ObservableSet<span style=color:#f92672>&lt;</span>Integer<span style=color:#f92672>&gt;</span> set <span style=color:#f92672>=</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>new</span> ObservableSet<span style=color:#f92672>&lt;&gt;(</span><span style=color:#66d9ef>new</span> HashSet<span style=color:#f92672>&lt;&gt;());</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        set<span style=color:#f92672>.</span><span style=color:#a6e22e>addObserver</span><span style=color:#f92672>(</span><span style=color:#66d9ef>new</span> SetObserver<span style=color:#f92672>&lt;&gt;()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>added</span><span style=color:#f92672>(</span>ObservableSet<span style=color:#f92672>&lt;</span>Integer<span style=color:#f92672>&gt;</span> s<span style=color:#f92672>,</span> Integer e<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                System<span style=color:#f92672>.</span><span style=color:#a6e22e>out</span><span style=color:#f92672>.</span><span style=color:#a6e22e>println</span><span style=color:#f92672>(</span>e<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>e <span style=color:#f92672>==</span> <span style=color:#ae81ff>23</span><span style=color:#f92672>)</span> <span style=color:#75715e>// ê°’ì´ 23ì´ë©´ ìì‹ ì„ êµ¬ë…í•´ì§€í•œë‹¤.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                    s<span style=color:#f92672>.</span><span style=color:#a6e22e>removeObserver</span><span style=color:#f92672>(</span><span style=color:#66d9ef>this</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>});</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> <span style=color:#f92672>(</span><span style=color:#66d9ef>int</span> i <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span><span style=color:#f92672>;</span> i <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>100</span><span style=color:#f92672>;</span> i<span style=color:#f92672>++)</span>
</span></span><span style=display:flex><span>            set<span style=color:#f92672>.</span><span style=color:#a6e22e>add</span><span style=color:#f92672>(</span>i<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì‹œ ConcurrentModificationException ë°œìƒ!</p><p>â†’ ë™ê¸°í™” ë¸”ëŸ­ ì•ˆì—ì„œ í´ë¼ì´ì–¸íŠ¸ ë©”ì„œë“œê°€ í˜¸ì¶œë˜ì—ˆê¸° ë•Œë¬¸ì— synchronizedì˜ ë³´í˜¸ë¥¼ ë°›ì§€ ëª»í•œë‹¤.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>// ì½”ë“œ 79-3 ì™¸ê³„ì¸ ë©”ì„œë“œë¥¼ ë™ê¸°í™” ë¸”ë¡ ë°”ê¹¥ìœ¼ë¡œ ì˜®ê²¼ë‹¤. - ì—´ë¦° í˜¸ì¶œ (424ìª½)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>private</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>notifyElementAdded</span><span style=color:#f92672>(</span>E element<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    List<span style=color:#f92672>&lt;</span>SetObserver<span style=color:#f92672>&lt;</span>E<span style=color:#f92672>&gt;&gt;</span> snapshot <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>synchronized</span><span style=color:#f92672>(</span>observers<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        snapshot <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> ArrayList<span style=color:#f92672>&lt;&gt;(</span>observers<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> <span style=color:#f92672>(</span>SetObserver<span style=color:#f92672>&lt;</span>E<span style=color:#f92672>&gt;</span> observer <span style=color:#f92672>:</span> snapshot<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>        observer<span style=color:#f92672>.</span><span style=color:#a6e22e>added</span><span style=color:#f92672>(</span><span style=color:#66d9ef>this</span><span style=color:#f92672>,</span> element<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>// ì½”ë“œ 79-4 CopyOnWriteArrayListë¥¼ ì‚¬ìš©í•´ êµ¬í˜„í•œ ìŠ¤ë ˆë“œ ì•ˆì „í•˜ê³  ê´€ì°° ê°€ëŠ¥í•œ ì§‘í•© (425ìª½)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> List<span style=color:#f92672>&lt;</span>SetObserver<span style=color:#f92672>&lt;</span>E<span style=color:#f92672>&gt;&gt;</span> observers <span style=color:#f92672>=</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>new</span> CopyOnWriteArrayList<span style=color:#f92672>&lt;&gt;();</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>addObserver</span><span style=color:#f92672>(</span>SetObserver<span style=color:#f92672>&lt;</span>E<span style=color:#f92672>&gt;</span> observer<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        observers<span style=color:#f92672>.</span><span style=color:#a6e22e>add</span><span style=color:#f92672>(</span>observer<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>removeObserver</span><span style=color:#f92672>(</span>SetObserver<span style=color:#f92672>&lt;</span>E<span style=color:#f92672>&gt;</span> observer<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> observers<span style=color:#f92672>.</span><span style=color:#a6e22e>remove</span><span style=color:#f92672>(</span>observer<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>notifyElementAdded</span><span style=color:#f92672>(</span>E element<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> <span style=color:#f92672>(</span>SetObserver<span style=color:#f92672>&lt;</span>E<span style=color:#f92672>&gt;</span> observer <span style=color:#f92672>:</span> observers<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>            observer<span style=color:#f92672>.</span><span style=color:#a6e22e>added</span><span style=color:#f92672>(</span><span style=color:#66d9ef>this</span><span style=color:#f92672>,</span> element<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span> <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>add</span><span style=color:#f92672>(</span>E element<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>boolean</span> added <span style=color:#f92672>=</span> <span style=color:#66d9ef>super</span><span style=color:#f92672>.</span><span style=color:#a6e22e>add</span><span style=color:#f92672>(</span>element<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>added<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>            notifyElementAdded<span style=color:#f92672>(</span>element<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> added<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span> <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>addAll</span><span style=color:#f92672>(</span>Collection<span style=color:#f92672>&lt;?</span> <span style=color:#66d9ef>extends</span> E<span style=color:#f92672>&gt;</span> c<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>boolean</span> result <span style=color:#f92672>=</span> <span style=color:#66d9ef>false</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> <span style=color:#f92672>(</span>E element <span style=color:#f92672>:</span> c<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>            result <span style=color:#f92672>|=</span> add<span style=color:#f92672>(</span>element<span style=color:#f92672>);</span>  <span style=color:#75715e>// notifyElementAddedë¥¼ í˜¸ì¶œí•œë‹¤.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>return</span> result<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span></code></pre></div></li></ul></li><li><p>ë™ê¸°í™” ì˜ì—­ì€ ìµœëŒ€í•œ ì‘ê²Œ ê°€ì ¸ê°€ì.</p></li><li><p>í•©ë‹¹í•œ ì´ìœ ê°€ ìˆì„ ë•Œë§Œ ë‚´ë¶€ì—ì„œ ë™ê¸°í™”í•˜ê³ , ë™ê¸°í™” ì—¬ë¶€ë¥¼ ë¬¸ì„œì— ëª…í™•íˆ ë°íˆì.</p></li></ul><h2 id=ì•„ì´í…œ-80-ìŠ¤ë ˆë“œë³´ë‹¤ëŠ”-ì‹¤í–‰ì-íƒœìŠ¤í¬-ìŠ¤íŠ¸ë¦¼ì„-ì• ìš©í•˜ë¼>ì•„ì´í…œ 80: ìŠ¤ë ˆë“œë³´ë‹¤ëŠ” ì‹¤í–‰ì, íƒœìŠ¤í¬, ìŠ¤íŠ¸ë¦¼ì„ ì• ìš©í•˜ë¼<a hidden class=anchor aria-hidden=true href=#ì•„ì´í…œ-80-ìŠ¤ë ˆë“œë³´ë‹¤ëŠ”-ì‹¤í–‰ì-íƒœìŠ¤í¬-ìŠ¤íŠ¸ë¦¼ì„-ì• ìš©í•˜ë¼>#</a></h2><p>ì‘ì—… íë¥¼ ë§Œë“¤ê¸° ìœ„í•´ ìŠ¤ë ˆë“œë¥¼ ì§ì ‘ ë‹¤ë£¨ê¸°ë³´ë‹¤ëŠ” java.util.concurrent í•˜ìœ„ì˜ ì‹¤í–‰ì í”„ë ˆì„ì›Œí¬ë¥¼ ì´ìš©í•˜ì.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>ExecutorService exec <span style=color:#f92672>=</span> Executors<span style=color:#f92672>.</span><span style=color:#a6e22e>newSingleThreadExecutor</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>exec<span style=color:#f92672>.</span><span style=color:#a6e22e>execute</span><span style=color:#f92672>(</span>runnable<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>exec<span style=color:#f92672>.</span><span style=color:#a6e22e>shutdown</span><span style=color:#f92672>();</span>
</span></span></code></pre></div><h3 id=ì‹¤í–‰ì-í”„ë ˆì„ì›Œí¬ì˜-ê¸°ëŠ¥>ì‹¤í–‰ì í”„ë ˆì„ì›Œí¬ì˜ ê¸°ëŠ¥<a hidden class=anchor aria-hidden=true href=#ì‹¤í–‰ì-í”„ë ˆì„ì›Œí¬ì˜-ê¸°ëŠ¥>#</a></h3><ul><li>íŠ¹ì • íƒœìŠ¤í¬ ì™„ë£Œ ëŒ€ê¸°</li><li>íƒœìŠ¤í¬ ëª¨ìŒ ì¤‘ ì•„ë¬´ê±°ë‚˜ í•˜ë‚˜, í˜¹ì€ ëª¨ë“  íƒœìŠ¤í¬ ì™„ë£Œ ëŒ€ê¸°</li><li>ì‹¤í–‰ì ì„œë¹„ìŠ¤ ì¢…ë£Œ ëŒ€ê¸°</li><li>ì™„ë£Œëœ íƒœìŠ¤í¬ì˜ ê²°ê³¼ë¥¼ ì°¨ë¡€ë¡œ ë°›ê¸°</li><li>íƒœìŠ¤í¬ë¥¼ íŠ¹ì • ì‹œê°„, í˜¹ì€ ì£¼ê¸°ë¡œ ì‹¤í–‰í•˜ê¸°</li></ul><p>í”„ë¡œê·¸ë¨ ê·œëª¨ì— ë”°ë¼ ê°ê° ë‹¤ë¥¸ ìŠ¤ë ˆë“œ ê´€ë¦¬ ë©”ì»¤ë‹ˆì¦˜ì„ ì‚¬ìš©í•˜ëŠ” ì‹¤í–‰ì ì„œë¹„ìŠ¤ë¥¼ ìƒì„±í•  ìˆ˜ ìˆë‹¤.</p><p>ex) Executors.newCachedThreadPool, Executors.newFixedThreadPool, &mldr;</p><p>ìë°” 7ë¶€í„°ëŠ” ForkJoinPoolì„ ì§€ì›í•˜ë„ë¡ ê°œëŸ‰ë˜ì–´ì„œ íš¨ìœ¨ì„±ì´ ê°œì„ ë˜ì—ˆë‹¤.</p><h2 id=ì•„ì´í…œ-81-waitê³¼-notifyë³´ë‹¤ëŠ”-ë™ì‹œì„±-ìœ í‹¸ë¦¬í‹°ë¥¼-ì• ìš©í•˜ë¼>ì•„ì´í…œ 81: waitê³¼ notifyë³´ë‹¤ëŠ” ë™ì‹œì„± ìœ í‹¸ë¦¬í‹°ë¥¼ ì• ìš©í•˜ë¼<a hidden class=anchor aria-hidden=true href=#ì•„ì´í…œ-81-waitê³¼-notifyë³´ë‹¤ëŠ”-ë™ì‹œì„±-ìœ í‹¸ë¦¬í‹°ë¥¼-ì• ìš©í•˜ë¼>#</a></h2><p>waitê³¼ notifyëŠ” ì˜¬ë°”ë¥´ê²Œ ì‚¬ìš©í•˜ê¸° ë§¤ìš° ì–´ë ¤ìš°ë¯€ë¡œ, ê³ ìˆ˜ì¤€ ë™ì‹œì„± ìœ í‹¸ë¦¬í‹°ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì¢‹ë‹¤.</p><h3 id=ê³ ìˆ˜ì¤€-ë™ì‹œì„±-ìœ í‹¸ë¦¬í‹°ì˜-ì¢…ë¥˜>ê³ ìˆ˜ì¤€ ë™ì‹œì„± ìœ í‹¸ë¦¬í‹°ì˜ ì¢…ë¥˜<a hidden class=anchor aria-hidden=true href=#ê³ ìˆ˜ì¤€-ë™ì‹œì„±-ìœ í‹¸ë¦¬í‹°ì˜-ì¢…ë¥˜>#</a></h3><ul><li>ì‹¤í–‰ì í”„ë ˆì„ì›Œí¬</li><li>ë™ì‹œì„± ì»¬ë ‰ì…˜<ul><li>ConcurrentHashMap ë“± ë‚´ë¶€ì—ì„œ ë™ê¸°í™”ë¥¼ íš¨ìœ¨ì ìœ¼ë¡œ êµ¬í˜„í•œ ì»¬ë ‰ì…˜</li><li>ìƒíƒœ ì˜ì¡´ì  ë©”ì„œë“œë“¤ì´ ì¶”ê°€ë˜ì–´ ìˆìŒ ex) putIfAbsent</li></ul></li><li>ë™ê¸°í™” ì¥ì¹˜<ul><li>CountDownLatch, Semaphore, &mldr;</li></ul></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>// ì½”ë“œ 81-3 ë™ì‹œ ì‹¤í–‰ ì‹œê°„ì„ ì¬ëŠ” ê°„ë‹¨í•œ í”„ë ˆì„ì›Œí¬ (433-434ìª½)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>ConcurrentTimer</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#a6e22e>ConcurrentTimer</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span> <span style=color:#f92672>}</span> <span style=color:#75715e>// ì¸ìŠ¤í„´ìŠ¤ ìƒì„± ë¶ˆê°€
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>long</span> <span style=color:#a6e22e>time</span><span style=color:#f92672>(</span>Executor executor<span style=color:#f92672>,</span> <span style=color:#66d9ef>int</span> concurrency<span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>                            Runnable action<span style=color:#f92672>)</span> <span style=color:#66d9ef>throws</span> InterruptedException <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        CountDownLatch ready <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> CountDownLatch<span style=color:#f92672>(</span>concurrency<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        CountDownLatch start <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> CountDownLatch<span style=color:#f92672>(</span><span style=color:#ae81ff>1</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        CountDownLatch done  <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> CountDownLatch<span style=color:#f92672>(</span>concurrency<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> <span style=color:#f92672>(</span><span style=color:#66d9ef>int</span> i <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span><span style=color:#f92672>;</span> i <span style=color:#f92672>&lt;</span> concurrency<span style=color:#f92672>;</span> i<span style=color:#f92672>++)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            executor<span style=color:#f92672>.</span><span style=color:#a6e22e>execute</span><span style=color:#f92672>(()</span> <span style=color:#f92672>-&gt;</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                ready<span style=color:#f92672>.</span><span style=color:#a6e22e>countDown</span><span style=color:#f92672>();</span> <span style=color:#75715e>// íƒ€ì´ë¨¸ì—ê²Œ ì¤€ë¹„ë¥¼ ë§ˆì³¤ìŒì„ ì•Œë¦°ë‹¤.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                <span style=color:#66d9ef>try</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                    start<span style=color:#f92672>.</span><span style=color:#a6e22e>await</span><span style=color:#f92672>();</span> <span style=color:#75715e>// ëª¨ë“  ì‘ì—…ì ìŠ¤ë ˆë“œê°€ ì¤€ë¹„ë  ë•Œê¹Œì§€ ê¸°ë‹¤ë¦°ë‹¤.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                    action<span style=color:#f92672>.</span><span style=color:#a6e22e>run</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>}</span> <span style=color:#66d9ef>catch</span> <span style=color:#f92672>(</span>InterruptedException e<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                    Thread<span style=color:#f92672>.</span><span style=color:#a6e22e>currentThread</span><span style=color:#f92672>().</span><span style=color:#a6e22e>interrupt</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>}</span> <span style=color:#66d9ef>finally</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                    done<span style=color:#f92672>.</span><span style=color:#a6e22e>countDown</span><span style=color:#f92672>();</span>  <span style=color:#75715e>// íƒ€ì´ë¨¸ì—ê²Œ ì‘ì—…ì„ ë§ˆì³¤ìŒì„ ì•Œë¦°ë‹¤.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>});</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        ready<span style=color:#f92672>.</span><span style=color:#a6e22e>await</span><span style=color:#f92672>();</span>     <span style=color:#75715e>// ëª¨ë“  ì‘ì—…ìê°€ ì¤€ë¹„ë  ë•Œê¹Œì§€ ê¸°ë‹¤ë¦°ë‹¤.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>long</span> startNanos <span style=color:#f92672>=</span> System<span style=color:#f92672>.</span><span style=color:#a6e22e>nanoTime</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        start<span style=color:#f92672>.</span><span style=color:#a6e22e>countDown</span><span style=color:#f92672>();</span> <span style=color:#75715e>// ì‘ì—…ìë“¤ì„ ê¹¨ìš´ë‹¤.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        done<span style=color:#f92672>.</span><span style=color:#a6e22e>await</span><span style=color:#f92672>();</span>      <span style=color:#75715e>// ëª¨ë“  ì‘ì—…ìê°€ ì¼ì„ ëë§ˆì¹˜ê¸°ë¥¼ ê¸°ë‹¤ë¦°ë‹¤.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>return</span> System<span style=color:#f92672>.</span><span style=color:#a6e22e>nanoTime</span><span style=color:#f92672>()</span> <span style=color:#f92672>-</span> startNanos<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>ì–´ì©” ìˆ˜ ì—†ì´ wait/notifyë¥¼ ì‚¬ìš©í•´ì•¼ í•  ë•Œì—ëŠ” wait í˜¸ì¶œ ì‹œ while ë¬¸ ì•ˆì—ì„œë§Œ í˜¸ì¶œí•˜ëŠ” í‘œì¤€ ë°©ì‹ì„ ë”°ë¥´ì.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>synchronized</span> <span style=color:#f92672>(</span>obj<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>while</span> <span style=color:#f92672>(&lt;</span><span style=color:#960050;background-color:#1e0010>ì¡°ê±´ì´</span> <span style=color:#960050;background-color:#1e0010>ì¶©ì¡±ë˜ì§€</span> <span style=color:#960050;background-color:#1e0010>ì•Šì•˜ë‹¤</span><span style=color:#f92672>&gt;)</span>
</span></span><span style=display:flex><span>        obj<span style=color:#f92672>.</span><span style=color:#a6e22e>wait</span><span style=color:#f92672>();</span> <span style=color:#75715e>// (ë½ì„ ë†“ê³ , ê¹¨ì–´ë‚˜ë©´ ë‹¤ì‹œ ì¡ëŠ”ë‹¤.)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#f92672>...</span> <span style=color:#75715e>// ì¡°ê±´ì´ ì¶©ì¡±ëì„ ë•Œì˜ ë™ì‘ì„ ìˆ˜í–‰í•œë‹¤.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#f92672>}</span>
</span></span></code></pre></div><h2 id=ì•„ì´í…œ-82-ìŠ¤ë ˆë“œ-ì•ˆì „ì„±-ìˆ˜ì¤€ì„-ë¬¸ì„œí™”í•˜ë¼>ì•„ì´í…œ 82: ìŠ¤ë ˆë“œ ì•ˆì „ì„± ìˆ˜ì¤€ì„ ë¬¸ì„œí™”í•˜ë¼<a hidden class=anchor aria-hidden=true href=#ì•„ì´í…œ-82-ìŠ¤ë ˆë“œ-ì•ˆì „ì„±-ìˆ˜ì¤€ì„-ë¬¸ì„œí™”í•˜ë¼>#</a></h2><p>ë©€í‹°ìŠ¤ë ˆë“œ í™˜ê²½ì—ì„œ APIë¥¼ ì•ˆì „í•˜ê²Œ ì‚¬ìš©í•˜ë ¤ë©´ í´ë˜ìŠ¤ê°€ ì§€ì›í•˜ëŠ” ìŠ¤ë ˆë“œ ì•ˆì „ì„± ìˆ˜ì¤€ì„ ëª…ì‹œí•´ì•¼ í•œë‹¤.\</p><h3 id=ìŠ¤ë ˆë“œ-ì•ˆì „ì„±-ìˆ˜ì¤€>ìŠ¤ë ˆë“œ ì•ˆì „ì„± ìˆ˜ì¤€<a hidden class=anchor aria-hidden=true href=#ìŠ¤ë ˆë“œ-ì•ˆì „ì„±-ìˆ˜ì¤€>#</a></h3><ul><li>ë¶ˆë³€</li><li>ë¬´ì¡°ê±´ì  ìŠ¤ë ˆë“œ ì•ˆì „: ìˆ˜ì •ë  ìˆ˜ ìˆìœ¼ë‚˜ ë‚´ë¶€ì—ì„œ ë™ê¸°í™”í•´ì„œ ë³„ë„ì˜ ì²˜ë¦¬ ì—†ì´ ìŠ¤ë ˆë“œ ì•ˆì „í•˜ê²Œ ì‚¬ìš© ê°€ëŠ¥í•˜ë‹¤.</li><li>ì¡°ê±´ë¶€ ìŠ¤ë ˆë“œ ì•ˆì „: ì¼ë¶€ ìŠ¤ë ˆë“œë¥¼ ì‚¬ìš©í•˜ë ¤ë©´ ì™¸ë¶€ ë™ê¸°í™”ê°€ í•„ìš”í•˜ë‹¤.</li><li>ìŠ¤ë ˆë“œ ì•ˆì „í•˜ì§€ ì•ŠìŒ: ë™ì‹œì— ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„œëŠ” ì™¸ë¶€ ë™ê¸°í™”ê°€ í•„ìš”í•˜ë‹¤.</li><li>ìŠ¤ë ˆë“œ ì ëŒ€ì : ì™¸ë¶€ ë™ê¸°í™”ë¡œ ê°ì‹¸ë”ë¼ë„ ë©€í‹°ìŠ¤ë ˆë“œ í™˜ê²½ì—ì„œ ì•ˆì „í•˜ì§€ ì•Šë‹¤. (ì •ì  ë°ì´í„°ë¥¼ ë™ê¸°í™” ì—†ì´ ìˆ˜ì •í•˜ëŠ” ê²½ìš°)</li></ul><p>ì¡°ê±´ë¶€ ìŠ¤ë ˆë“œ ì•ˆì „í•œ í´ë˜ìŠ¤ëŠ” ì£¼ì˜í•´ì„œ ì–´ë–¤ ìˆœì„œë¡œ í˜¸ì¶œí•  ë•Œ ë™ê¸°í™” ë¡œì§ì´ í•„ìš”í•œì§€, ì–´ë–¤ ë½ì„ ì–»ì–´ì•¼ í•˜ëŠ”ì§€ ê¸°ìˆ í•´ì•¼ í•œë‹¤.</p><p>ê³µê°œëœ ë½ì„ ì‚¬ìš©í•˜ëŠ” ê²½ìš° í´ë¼ì´ì–¸íŠ¸ì—ì„œ ë½ì„ í’€ì§€ ì•ŠëŠ” ì„œë¹„ìŠ¤ ê±°ë¶€ ê³µê²©ì„ í•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì—, ë¹„ê³µê°œ ë½ ê°ì²´ë¥¼ ì‚¬ìš©í•˜ê³  finalë¡œ ì„ ì–¸í•˜ëŠ” ê²ƒì´ ì¢‹ë‹¤.</p><h2 id=ì•„ì´í…œ-83-ì§€ì—°-ì´ˆê¸°í™”ëŠ”-ì‹ ì¤‘íˆ-ì‚¬ìš©í•˜ë¼>ì•„ì´í…œ 83: ì§€ì—° ì´ˆê¸°í™”ëŠ” ì‹ ì¤‘íˆ ì‚¬ìš©í•˜ë¼<a hidden class=anchor aria-hidden=true href=#ì•„ì´í…œ-83-ì§€ì—°-ì´ˆê¸°í™”ëŠ”-ì‹ ì¤‘íˆ-ì‚¬ìš©í•˜ë¼>#</a></h2><p>ìƒí™©ì— ë”°ë¼ ì§€ì—° ì´ˆê¸°í™”ëŠ” ì˜¤íˆë ¤ ì„±ëŠ¥ì„ ë” ëŠë¦¬ê²Œ ë§Œë“¤ ìˆ˜ ìˆìœ¼ë¯€ë¡œ ì‹ ì¤‘íˆ ì‚¬ìš©í•´ì•¼ í•œë‹¤.</p><p>ëŒ€ë¶€ë¶„ì˜ ìƒí™©ì—ì„œëŠ” ì¼ë°˜ì ì¸ ì´ˆê¸°í™”ê°€ ì¢‹ë‹¤.</p><h3 id=ë©€í‹°ìŠ¤ë ˆë“œ-í™˜ê²½ì—ì„œì˜-ì§€ì—°-ì´ˆê¸°í™”>ë©€í‹°ìŠ¤ë ˆë“œ í™˜ê²½ì—ì„œì˜ ì§€ì—° ì´ˆê¸°í™”<a hidden class=anchor aria-hidden=true href=#ë©€í‹°ìŠ¤ë ˆë“œ-í™˜ê²½ì—ì„œì˜-ì§€ì—°-ì´ˆê¸°í™”>#</a></h3><ul><li><p>ì§€ì—° ì´ˆê¸°í™”ê°€ ì´ˆê¸°í™” ìˆœí™˜ì„±ì„ ê¹¨ëœ¨ë¦´ ê²ƒ ê°™ìœ¼ë©´ synchronizedë¥¼ ë‹¨ ì ‘ê·¼ìë¥¼ ì‚¬ìš©í•˜ì.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>// ì½”ë“œ 83-2 ì¸ìŠ¤í„´ìŠ¤ í•„ë“œì˜ ì§€ì—° ì´ˆê¸°í™” - synchronized ì ‘ê·¼ì ë°©ì‹ (443ìª½)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>private</span> FieldType field2<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>synchronized</span> FieldType <span style=color:#a6e22e>getField2</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>field2 <span style=color:#f92672>==</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>            field2 <span style=color:#f92672>=</span> computeFieldValue<span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> field2<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span></code></pre></div></li><li><p>ì„±ëŠ¥ ë•Œë¬¸ì— ì •ì  í•„ë“œë¥¼ ì§€ì—° ì´ˆê¸°í™”í•´ì•¼ í•œë‹¤ë©´ ì§€ì—° ì´ˆê¸°í™” í™€ë” í´ë˜ìŠ¤ ê´€ìš©êµ¬ë¥¼ ì‚¬ìš©í•˜ì.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>// ì½”ë“œ 83-3 ì •ì  í•„ë“œìš© ì§€ì—° ì´ˆê¸°í™” í™€ë” í´ë˜ìŠ¤ ê´€ìš©êµ¬ (443ìª½)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>FieldHolder</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>final</span> FieldType field <span style=color:#f92672>=</span> computeFieldValue<span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> FieldType <span style=color:#a6e22e>getField</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span> <span style=color:#66d9ef>return</span> FieldHolder<span style=color:#f92672>.</span><span style=color:#a6e22e>field</span><span style=color:#f92672>;</span> <span style=color:#f92672>}</span>
</span></span></code></pre></div></li><li><p>ì„±ëŠ¥ ë•Œë¬¸ì— ì¸ìŠ¤í„´ìŠ¤ í•„ë“œë¥¼ ì§€ì—° ì´ˆê¸°í™”í•´ì•¼ í•œë‹¤ë©´ ì´ì¤‘ ê²€ì‚¬ ê´€ìš©êµ¬ë¥¼ ì‚¬ìš©í•˜ì.</p><p>â†’ ì´ë¯¸ ì´ˆê¸°í™”ëœ ê²½ìš° synchronized ë¸”ëŸ­ì— ì§„ì…í•˜ì§€ ì•Šì•„ì„œ ì ‘ê·¼ ë¹„ìš©ì´ ì‘ì•„ì§„ë‹¤.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>// ì½”ë“œ 83-4 ì¸ìŠ¤í„´ìŠ¤ í•„ë“œ ì§€ì—° ì´ˆê¸°í™”ìš© ì´ì¤‘ê²€ì‚¬ ê´€ìš©êµ¬ (444ìª½)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>volatile</span> FieldType field4<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> FieldType <span style=color:#a6e22e>getField4</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        FieldType result <span style=color:#f92672>=</span> field4<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>result <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>)</span>    <span style=color:#75715e>// ì²« ë²ˆì§¸ ê²€ì‚¬ (ë½ ì‚¬ìš© ì•ˆ í•¨)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            <span style=color:#66d9ef>return</span> result<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>synchronized</span><span style=color:#f92672>(</span><span style=color:#66d9ef>this</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>field4 <span style=color:#f92672>==</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>)</span> <span style=color:#75715e>// ë‘ ë²ˆì§¸ ê²€ì‚¬ (ë½ ì‚¬ìš©)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                field4 <span style=color:#f92672>=</span> computeFieldValue<span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> field4<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span></code></pre></div></li><li><p>ë°˜ë³µí•´ì„œ ì´ˆê¸°í™”í•´ë„ ìƒê´€ì—†ëŠ” ê²½ìš° ë™ê¸°í™” ì—†ì´ ë‹¨ì¼ ê²€ì‚¬í•´ë„ ê´œì°®ë‹¤.</p></li></ul><h2 id=ì•„ì´í…œ-84-í”„ë¡œê·¸ë¨ì˜-ë™ì‘ì„-ìŠ¤ë ˆë“œ-ìŠ¤ì¼€ì¤„ëŸ¬ì—-ê¸°ëŒ€ì§€-ë§ë¼>ì•„ì´í…œ 84: í”„ë¡œê·¸ë¨ì˜ ë™ì‘ì„ ìŠ¤ë ˆë“œ ìŠ¤ì¼€ì¤„ëŸ¬ì— ê¸°ëŒ€ì§€ ë§ë¼<a hidden class=anchor aria-hidden=true href=#ì•„ì´í…œ-84-í”„ë¡œê·¸ë¨ì˜-ë™ì‘ì„-ìŠ¤ë ˆë“œ-ìŠ¤ì¼€ì¤„ëŸ¬ì—-ê¸°ëŒ€ì§€-ë§ë¼>#</a></h2><p>ìŠ¤ë ˆë“œ ìŠ¤ì¼€ì¤„ëŸ¬ì˜ ë™ì‘ì€ í”Œë«í¼, ìš´ì˜ì²´ì œë§ˆë‹¤ ë‹¤ë¥´ê¸° ë•Œë¬¸ì— ë‹¤ë¥¸ í”Œë«í¼ì— ì´ì‹í•˜ê¸° ì–´ë ¤ì›Œì§ˆ ìˆ˜ ìˆë‹¤.</p><ul><li><p>ì‹¤í–‰ ê°€ëŠ¥í•œ ìŠ¤ë ˆë“œì˜ ìˆ˜ê°€ í”„ë¡œì„¸ìŠ¤ì˜ ìˆ˜ë³´ë‹¤ ê³¼ë„í•˜ê²Œ ë§ì•„ì„œëŠ” ì•ˆ ëœë‹¤.</p></li><li><p>ìŠ¤ë ˆë“œëŠ” ë‹¹ì¥ ì²˜ë¦¬í•´ì•¼ í•  ì‘ì—…ì´ ì—†ë‹¤ë©´ ì‹¤í–‰ë˜ì–´ì„œëŠ” ì•ˆ ëœë‹¤.</p></li><li><p>ìŠ¤ë ˆë“œëŠ” ì ˆëŒ€ ë°”ìœ ëŒ€ê¸° ìƒíƒœê°€ ë˜ì–´ì„œëŠ” ì•ˆ ëœë‹¤.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>// ì½”ë“œ 84-1 ë”ì°í•œ CountDownLatch êµ¬í˜„ - ë°”ìœ ëŒ€ê¸° ë²„ì „! (447ìª½)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>SlowCountDownLatch</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>int</span> count<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>SlowCountDownLatch</span><span style=color:#f92672>(</span><span style=color:#66d9ef>int</span> count<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>count <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>0</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> IllegalArgumentException<span style=color:#f92672>(</span>count <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34; &lt; 0&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>count</span> <span style=color:#f92672>=</span> count<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>await</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>while</span> <span style=color:#f92672>(</span><span style=color:#66d9ef>true</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>synchronized</span><span style=color:#f92672>(</span><span style=color:#66d9ef>this</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>count <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>return</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>synchronized</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>countDown</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>count <span style=color:#f92672>!=</span> <span style=color:#ae81ff>0</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>            count<span style=color:#f92672>--;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span></code></pre></div><p>â†’ ì´ ë¬¸ì œë¥¼ ê³ ì¹œë‹µì‹œê³  Thread.yield ë“±ì„ ì‚¬ìš©í•œë‹¤ë©´ JVM êµ¬í˜„ì²´ë³„ë¡œ ë‹¤ë¥¸ íš¨ê³¼ì— ì´ì‹ì„±ë§Œ ë‚˜ë¹ ì§€ëŠ” ê²°ê³¼ë¥¼ ì´ˆë˜í•  ìˆ˜ ìˆë‹¤.</p></li></ul></div><footer class=post-footer><ul class=post-tags><li><a href=https://junbread.win/tags/study/>Study</a></li><li><a href=https://junbread.win/tags/java/>Java</a></li></ul><nav class=paginav><a class=prev href=https://junbread.win/posts/2021/effective-java-10/><span class=title>Â« Prev</span><br><span>ì´í™í‹°ë¸Œ ìë°” 10ì¥ ì •ë¦¬</span></a>
<a class=next href=https://junbread.win/posts/2021/effective-java-12/><span class=title>Next Â»</span><br><span>ì´í™í‹°ë¸Œ ìë°” 12ì¥ ì •ë¦¬</span></a></nav></footer><script src=https://giscus.app/client.js data-repo=junbread/blog data-repo-id=R_kgDOJLcBtQ data-category=Comments data-category-id=DIC_kwDOJLcBtc4CVATm data-mapping=pathname data-strict=0 data-reactions-enabled=1 data-emit-metadata=1 data-input-position=top data-theme=dark data-lang=ko data-loading=lazy crossorigin=anonymous async></script></article></main><footer class=footer><span>&copy; 2023 <a href=https://junbread.win>JunbreadğŸ¥</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>